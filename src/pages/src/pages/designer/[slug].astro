---
import { createClient } from '@sanity/client'
import imageUrlBuilder from '@sanity/image-url'

const client = createClient({
  projectId: import.meta.env.PUBLIC_SANITY_PROJECT_ID,
  dataset: import.meta.env.PUBLIC_SANITY_DATASET,
  apiVersion: '2024-01-01',
  useCdn: true,
})

const builder = imageUrlBuilder(client)
const urlFor = (source) => builder.image(source)

const { slug } = Astro.params

const designer = await client.fetch(
  `*[_type == "designer" && slug.current == $slug][0]{
    name,
    category,
    area,
    about,
    gallery,
    instagram,
    website,
    seoTitle,
    seoDescription
  }`,
  { slug }
)

if (!designer) {
  return new Response('Not found', { status: 404 })
}
---

<html lang="en">
  <head>
    <title>{designer.seoTitle || `${designer.name} | Hyderabad Labels`}</title>
    <meta
      name="description"
      content={designer.seoDescription || designer.about?.slice(0, 160)}
    />
  </head>

  <body style="max-width:1100px;margin:auto;padding:40px;">
    <h1>{designer.name}</h1>

    <p><strong>{designer.category}</strong> Â· {designer.area}</p>

    {designer.gallery && (
      <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:16px;margin:30px 0;">
        {designer.gallery.map((img) => (
          <img
            src={urlFor(img).width(800).url()}
            alt={designer.name}
            style="width:100%;border-radius:12px;"
          />
        ))}
      </div>
    )}

    <p>{designer.about}</p>

    <div style="margin-top:30px;">
      {designer.instagram && (
        <p>
          Instagram:
          <a href={designer.instagram} target="_blank">
            {designer.instagram}
          </a>
        </p>
      )}

      {designer.website && (
        <p>
          Website:
          <a href={designer.website} target="_blank">
            {designer.website}
          </a>
        </p>
      )}
    </div>
  </body>
</html>
